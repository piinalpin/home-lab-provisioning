auto lo
iface lo inet loopback

iface enp0s31f6 inet manual

auto vmbr0
iface vmbr0 inet manual
    address 192.168.56.10/24
    bridge-ports none
    bridge-stp off
    bridge-fd 0

    post-up echo 1 > /proc/sys/net/ipv4/ip_forward
    post-up   iptables -t nat -A POSTROUTING -s '192.168.56.0/24' -o wlp3s0 -j MASQUERADE
    post-down iptables -t nat -D POSTROUTING -s '192.168.56.0/24' -o wlp3s0 -j MASQUERADE


auto wlp3s0
iface wlp3s0 inet static
    address 192.168.1.4/24
    netmask 255.255.255.0
    gateway 192.168.1.1
    wpa-ssid "<YOUR SSID>"
    wpa-psk "<YOUR PASSWORD>"
    
    post-up echo 1 > /proc/sys/net/ipv4/ip_forward
    
    # k8s-master 192.168.56.11
    post-up   iptables -i wlp3s0 -I INPUT -p tcp -s 192.168.1.4/24 --dport 50501 -j ACCEPT
    post-up   iptables -t nat -A PREROUTING -i wlp3s0 -p tcp --dport 50501 -j DNAT --to-destination 192.168.56.11:22
    post-up   iptables -t nat -A PREROUTING -i wlp3s0 -p tcp --dport 46443 -j DNAT --to-destination 192.168.56.11:6443
    post-down iptables -t nat -D PREROUTING -i wlp3s0 -p tcp --dport 50501 -j DNAT --to-destination 192.168.56.11:22
    post-down iptables -t nat -D PREROUTING -i wlp3s0 -p tcp --dport 46443 -j DNAT --to-destination 192.168.56.11:6443

    # k8s-node-01 192.168.56.12
    post-up   iptables -i wlp3s0 -I INPUT -p tcp -s 192.168.1.4/24 --dport 50502 -j ACCEPT
    post-up   iptables -t nat -A PREROUTING -i wlp3s0 -p tcp --dport 50502 -j DNAT --to-destination 192.168.56.12:22
    post-down iptables -t nat -D PREROUTING -i wlp3s0 -p tcp --dport 50502 -j DNAT --to-destination 192.168.56.12:22

    # k8s-node-01 192.168.56.13
    post-up   iptables -i wlp3s0 -I INPUT -p tcp -s 192.168.1.4/24 --dport 50503 -j ACCEPT
    post-up   iptables -t nat -A PREROUTING -i wlp3s0 -p tcp --dport 50503 -j DNAT --to-destination 192.168.56.13:22
    post-down iptables -t nat -D PREROUTING -i wlp3s0 -p tcp --dport 50503 -j DNAT --to-destination 192.168.56.13:22

    # If have more VM that will be exposed via port forwarding should added iptables mapping
    
    post-up iptables -t nat -A POSTROUTING -s '192.168.1.0/24' -o vmbr0 -j MASQUERADE
    post-down iptables -t nat -D POSTROUTING -s '192.168.1.0/24' -o vmbr0 -j MASQUERADE

source /etc/network/interfaces.d/*